#coding=utf-8
from deepdiff import DeepDiff
import requests
from time import sleep
sellers = {
	'BHHG': {
		'auth': '720ddc067f4d115bd544aff46bc75634',
		'scert': '3C60EB49-3BB3-47FE-88AD-780F57080110'
	},
	'BG9H': {
		'auth': '720ddc067f4d115bd544aff46bc75654',
		'scert': '21ec2020-3aea-1069-a2dd-08002b303100'
	},
	'V01R': {
		'auth': 'd6b18944375b432fa52dd326a5daf373',
		'scert': '3db4a85f-f9d7-4897-8c4d-92906ea632e9'
	},
	'D08W': {
		'auth': '75a097d72d434704b4b48eb00dfbd036',
		'scert': 'afa29c6d-2fec-45d3-a72b-2bab97ba5b6d'
	},
'BFWB': {
		'auth': '46dd113e5b72170b7488b5c781bcd0a0',
		'scert': '21EC2020-3AEA-1069-A2DD-08002B303100'
	},
'D078': {
		'auth': 'bcd753111e0c4670bf6e3b0bf72d1f63',
		'scert': '9db3732b-224d-47a8-aac9-25de532bf440'
	}
}

versions = ['&version=304', '&version=305', '&version=306',  '&version=308', '&version=309']
# #BHHG
# orders = ["230496735"] #BG9T

orders = ["230154615"]
#375895363

seller = 'BHHG'
#BJAN
# orders = ["2137353780","2137714380","2137714820","2137715060","2137726620","2137772100","230429955","230437015","230438955","230439075","230439095","230439115","230439135","230439155","230439175","230439235","230439255","230439275","230439295","230439315","230439335","230439355","230439375","230439395","230439415","230439435","230439535","230444575","230444715","230444975","230444995","230445015","230445035","230445055","230445075","230445135","230445155","230445175","230445195","230445215","230445235","230445335","230445475","230445495","230445515","230468915","230468955","230469155","230469335","230469355","230469375","230469395","230472035","230472155","2137384080","2137374200","2137374220","2137374240","2137375860","2137376120","2137376960","2137377460","2137379740","2137381340","2137381360","2137381380","2137381460","2137381520","2137381540","2137382920","2137382960","2137383340","2137383400","2137383660","2100509021","2100509061","2137353740","2137374060"]
# done_index = orders.index('2137384080')

# # V01R
# orders = ["1250181120","1250248200","1250181640","1250271760","1250181140","1250248220","1250181660","1250359840","1250180640","1250178080","1250361380","1250271780","1200236069","1250181160","1250382380","1250248240","1250359860","1250180660","1250178100","1250271800","1250359880","1250361420","1250271820","1250181200","1200281169","1250271840","1250181220","1200281189","1250271860","1250181240","1250251400","1250181260","1250180760","1250251420","1250238620","1250181280","1250177700","1250276520","1250179240","1250180780","1200236209","1250181300","1250181320","1250181340","1250177760","1250251500","1250181360","1250177780","1250251520","1250285320","1250243340","1250251540","1250243860","1250247960","1250338080","1250271520","1250243360","1250247980","1250280240","1250271540","1250248000","1250180420","1200303429","1250338120","1250271560","1250180940","1250284880","1250243920","1250186580","1250179420","1250243940","1250186600","1250178920","1250178040","2137686400","1250249600","1250360200","1250181000","1250180500","1250245020","1250181020","1250175900","1250180520","1250338220","1250271660","1250245040","1250181040","1250339260","2137686460","1250179580","1250271680","1250181060","1250175940","1250180600","1250271700","1250245080","1250181080","1250178020","2137686520","1250361340"]
# done_index = orders.index('1250248000')

# #D08W
# orders = ['230208115', '2100508821', '2100505181', '2137794800', '230472115', '230189055', '2100501781', '2137169020', '2137157720', '2100502401', '2100503701', '230393295', '2100481281', '2100505121', '2100503741', '2100481161', '2100501941', '230469455', '2137794780', '2137272820', '2100505801', '2137355900', '2100505301', '230385775', '230453995', '230363215', '230455575', '2137356540', '2100502801', '2100502461', '230233155', '230188875', '2100507981', '2100503261', '2100502701', '2137274700', '2137220380', '2100508021', '230082755', '2137355880', '2100481301', '2137142300', '230393215', '2100506621', '2100502781', '2137308520', '230279315', '230097375', '2100501881', '2100481741', '230394535', '2100503181', '2100505261', '230363055', '2100481761', '2137293260', '230473115', '2100505721', '2100505141', '2100501921', '2100503241', '230362875', '2137308500', '2100501981', '2100504241', '2137795420', '230160895', '2100501841', '2137330580', '230281995', '2137300140', '230393375', '230381355', '2137157640', '230292055', '2100481261', '2100504221', '2137308540', '230233135', '2100501661', '2100505201', '2100505741', '230316795', '230097815', '230340355', '2100505781', '2100505701', '2100502861', '2137283380', '2137328560', '2100501621', '2137275820', '230198135', '2100505241', '2100504561', '2100504201', '2100505281', '2137726960', '2100481201', '2100481341', '2100501901', '2100505761', '2100501861', '230088095', '230435615', '230282275', '2137795600', '2100503521', '2137329640', '2137330680', '2100505081', '230316895', '2100501821', '2100504581', '2100505041', '2100504321', '2100505101', '2100506641', '230394455', '2100503721', '2100501581', '2100505061', '2100501801', '2100501961', '230340375', '230362915', '230472235', '230085215', '230456775', '2100503221', '2100504541', '2137680540', '230294215', '2100506701', '230473515', '2137285060', '230154315', '2100503761', '2100503901', '2100505221', '2100501641', '230281415', '2100503201', '2100481721', '2137117920', '2100502821', '2100481321', '2137794700', '2100503921', '2100502421', '2137293160', '2137357180', '230087535', '230458295', '2100502381', '230287195', '2100502441', '2137169380', '2137374280', '2137379420', '2137292240', '230192355', '2100505001', '230362955', '230129175', '2137300160', '230473075', '2137357480', '230087475', '2100508001', '2100481701', '2100505021', '2100481821', '2100505821', '2137329620', '2100502841', '2100501601', '230363155', '2137291840', '2137287040', '230317755', '2100505161', '230292035', '230473415']
# done_index = orders.index('230393295')

# seller = 'BG9H'
auth = sellers[seller]['auth']
scert = sellers[seller]['scert']

session = requests.Session()



for version in versions:
	# url_2 = 'http://172.16.168.60:11800/b2b/ordermgmt/order/orderinfo?sellerid=%s%s' %(seller, version)
	# url_1 = 'http://172.16.168.60/b2b/ordermgmt/order/orderinfo?sellerid=%s%s' %(seller, version)
	url_2 = 'http://172.16.168.60:11800/ordermgmt/order/orderinfo?sellerid=%s%s' % (seller, version)
	url_1 = 'http://172.16.168.60/ordermgmt/order/orderinfo?sellerid=%s%s' % (seller, version)
	print(url_1)
	print(url_2)
	headers = {
		'Content-Type':'application/json',
		'Accept':'application/json',
		'Authorization':auth,
		'SecretKey':scert
	}


	for order in orders:
		print(version, order)
		body = {
			"OperationType": "GetOrderInfoRequest",
			"RequestBody": {
				"PageIndex": "1",
				"PageSize": "10",
				"RequestCriteria": {
					"OrderNumberList": {
						"OrderNumber": [
							order
						]
					}
				}
			}
		}

		r_1 = session.put(url_1, json=body, headers=headers)
		a_1 = r_1.json()
		# print(a_1)
		if a_1['ResponseBody']['PageInfo']['TotalCount'] == 0:
			continue
		r_2 = session.put(url_2, json=body, headers=headers)
		a_2 = r_2.json()



		diff = DeepDiff(a_1, a_2, verbose_level=2)
		for k, v in diff.items():
			if k == 'dictionary_item_added':
				print('新增字段')
				for j,k in v.items():
					print(j,k)
			print('-'*10)
			if k == 'values_changed':
				print('值变动')
				for j,k in v.items():
					print(j,k)

			else:
				print(k,v)
		print('-'*20)
		sleep(0.5)